{"version":3,"file":"DefaultRenderNode.esm.js","sources":["../../../src/components/EntityRelationsGraph/DefaultRenderNode.tsx"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { DependencyGraphTypes } from '@backstage/core-components';\nimport { useApp } from '@backstage/core-plugin-api';\nimport { humanizeEntityRef } from '@backstage/plugin-catalog-react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport classNames from 'classnames';\nimport React, { useLayoutEffect, useRef, useState } from 'react';\nimport { EntityKindIcon } from './EntityKindIcon';\nimport { EntityNodeData } from './types';\nimport { DEFAULT_NAMESPACE } from '@backstage/catalog-model';\n\nconst useStyles = makeStyles(\n  theme => ({\n    node: {\n      fill: theme.palette.grey[300],\n      stroke: theme.palette.grey[300],\n\n      '&.primary': {\n        fill: theme.palette.primary.light,\n        stroke: theme.palette.primary.light,\n      },\n      '&.secondary': {\n        fill: theme.palette.secondary.light,\n        stroke: theme.palette.secondary.light,\n      },\n    },\n    text: {\n      fill: theme.palette.getContrastText(theme.palette.grey[300]),\n\n      '&.primary': {\n        fill: theme.palette.primary.contrastText,\n      },\n      '&.secondary': {\n        fill: theme.palette.secondary.contrastText,\n      },\n      '&.focused': {\n        fontWeight: 'bold',\n      },\n    },\n    clickable: {\n      cursor: 'pointer',\n    },\n  }),\n  { name: 'PluginCatalogGraphCustomNode' },\n);\n\nexport function DefaultRenderNode({\n  node: { id, entity, color = 'default', focused, onClick },\n}: DependencyGraphTypes.RenderNodeProps<EntityNodeData>) {\n  const classes = useStyles();\n  const [width, setWidth] = useState(0);\n  const [height, setHeight] = useState(0);\n  const app = useApp();\n  const idRef = useRef<SVGTextElement | null>(null);\n\n  useLayoutEffect(() => {\n    // set the width to the length of the ID\n    if (idRef.current) {\n      let { height: renderedHeight, width: renderedWidth } =\n        idRef.current.getBBox();\n      renderedHeight = Math.round(renderedHeight);\n      renderedWidth = Math.round(renderedWidth);\n\n      if (renderedHeight !== height || renderedWidth !== width) {\n        setWidth(renderedWidth);\n        setHeight(renderedHeight);\n      }\n    }\n  }, [width, height]);\n\n  const {\n    kind,\n    metadata: { name, namespace = DEFAULT_NAMESPACE, title },\n  } = entity;\n\n  const hasKindIcon = app.getSystemIcon(\n    `kind:${kind.toLocaleLowerCase('en-US')}`,\n  );\n  const padding = 10;\n  const iconSize = height;\n  const paddedIconWidth = hasKindIcon ? iconSize + padding : 0;\n  const paddedWidth = paddedIconWidth + width + padding * 2;\n  const paddedHeight = height + padding * 2;\n\n  const displayTitle =\n    title ??\n    (kind && name && namespace\n      ? humanizeEntityRef({ kind, name, namespace })\n      : id);\n\n  return (\n    <g onClick={onClick} className={classNames(onClick && classes.clickable)}>\n      <rect\n        className={classNames(\n          classes.node,\n          color === 'primary' && 'primary',\n          color === 'secondary' && 'secondary',\n        )}\n        width={paddedWidth}\n        height={paddedHeight}\n        rx={10}\n      />\n      {hasKindIcon && (\n        <EntityKindIcon\n          kind={kind}\n          y={padding}\n          x={padding}\n          width={iconSize}\n          height={iconSize}\n          className={classNames(\n            classes.text,\n            focused && 'focused',\n            color === 'primary' && 'primary',\n            color === 'secondary' && 'secondary',\n          )}\n        />\n      )}\n      <text\n        ref={idRef}\n        className={classNames(\n          classes.text,\n          focused && 'focused',\n          color === 'primary' && 'primary',\n          color === 'secondary' && 'secondary',\n        )}\n        y={paddedHeight / 2}\n        x={paddedIconWidth + (width + padding * 2) / 2}\n        textAnchor=\"middle\"\n        alignmentBaseline=\"middle\"\n      >\n        {displayTitle}\n      </text>\n    </g>\n  );\n}\n"],"names":[],"mappings":"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"}